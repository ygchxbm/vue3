{"version":3,"file":"reactivity.esm-bundler.js","sources":["../../shared/src/index.ts","../src/baseHandler.ts","../src/reactive.ts"],"sourcesContent":["export  function isObject(target){\r\n    return typeof target==='object'&&target !==null\r\n}\r\n","import {isObject} from \"@hzb/shared\";\r\nimport {reactive, readonly} from \"./reactive\";\r\n\r\nconst get = createGetter();\r\nconst shallowReactiveGet = createGetter(true);\r\nconst readonlyGet = createGetter(false, true)\r\nconst shallowReadonlyGet = createGetter(true, true)\r\n\r\nconst set=createSetter();\r\nconst shallowReactiveSet=createSetter(true);\r\n\r\nfunction createGetter(isShallow = false, isReadonly = true) {\r\n    return function get(target, key, receiver) {\r\n        const res = Reflect.get(target, key, receiver)\r\n        if (isReadonly) {\r\n            // return target\r\n        } else {\r\n            //收集依赖\r\n        }\r\n\r\n        if (isShallow) {\r\n            return res\r\n        } else {\r\n            if (isObject(res)) {\r\n                //key对应的value 是对象，要递归,且已经不是浅的\r\n                //性能优化 懒代理\r\n                return isReadonly?readonly(res):reactive(res);\r\n            }\r\n\r\n        }\r\n    }\r\n}\r\n\r\nfunction createSetter(isShallow=false){\r\n return function set(){\r\n\r\n }\r\n}\r\n\r\nexport const reactiveHandler = {\r\n    get,\r\n    set\r\n};\r\nexport const shallowReactiveHandler = {\r\n    get: shallowReactiveGet,\r\n    set:shallowReactiveSet\r\n};\r\nexport const readonlyHandler = {\r\n    get: readonlyGet,\r\n    set:(target,key,value)=>{\r\n        console.error(\"set on key is failed\" )\r\n    }\r\n};\r\nexport const shallowReadonlyHandler = {\r\n    get: shallowReadonlyGet,\r\n    set:(target,key,value)=>{\r\n        console.error(\"set on key is failed\" )\r\n    }\r\n};\r\n","import {isObject} from \"@hzb/shared\";\r\nimport {reactiveHandler,shallowReactiveHandler,readonlyHandler,shallowReadonlyHandler} from './baseHandler'\r\n\r\nexport function reactive(target) {\r\n    return createReactObj(target, false, reactiveHandler);\r\n}\r\n\r\nexport function shallowReactive(target) {\r\n    return createReactObj(target, false, shallowReactiveHandler);\r\n}\r\n\r\nexport function readonly(target) {\r\n    return createReactObj(target, true, readonlyHandler);\r\n}\r\n\r\nexport function shallowReadonly(target) {\r\n    return createReactObj(target, true, shallowReadonlyHandler);\r\n}\r\n\r\n//哈希表，避免重复代理\r\nconst reactiveMap = new WeakMap();\r\nconst readonlyMap = new WeakMap();\r\n\r\nfunction createReactObj(target, isReadobly, baseHandler) {\r\n    if (!isObject(target)) {\r\n        return target\r\n    } else {\r\n        //优化，避免重复优化\r\n        const proxyMap = isReadobly ? readonlyMap : reactiveMap;\r\n        if (proxyMap.has(target)) {\r\n            return proxyMap.get(target);\r\n        } else {\r\n            const proxy = new Proxy(target, baseHandler)\r\n            proxyMap.set(target, proxy);\r\n            return proxy\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}