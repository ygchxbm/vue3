{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/baseHandler.ts","../src/reactive.ts"],"sourcesContent":["export  function isObject(target){\r\n    return typeof target==='object'&&target !==null\r\n}\r\n","import {isObject} from \"@hzb/shared\";\r\nimport {reactive, readonly} from \"./reactive\";\r\n\r\nconst get = createGetter();\r\nconst shallowReactiveGet = createGetter(true);\r\nconst readonlyGet = createGetter(false, true)\r\nconst shallowReadonlyGet = createGetter(true, true)\r\n\r\nconst set=createSetter();\r\nconst shallowReactiveSet=createSetter(true);\r\n\r\nfunction createGetter(isShallow = false, isReadonly = true) {\r\n    return function get(target, key, receiver) {\r\n        const res = Reflect.get(target, key, receiver)\r\n        if (isReadonly) {\r\n            // return target\r\n        } else {\r\n            //收集依赖\r\n        }\r\n\r\n        if (isShallow) {\r\n            return res\r\n        } else {\r\n            if (isObject(res)) {\r\n                //key对应的value 是对象，要递归,且已经不是浅的\r\n                //性能优化 懒代理\r\n                return isReadonly?readonly(res):reactive(res);\r\n            }\r\n\r\n        }\r\n    }\r\n}\r\n\r\nfunction createSetter(isShallow=false){\r\n return function set(){\r\n\r\n }\r\n}\r\n\r\nexport const reactiveHandler = {\r\n    get,\r\n    set\r\n};\r\nexport const shallowReactiveHandler = {\r\n    get: shallowReactiveGet,\r\n    set:shallowReactiveSet\r\n};\r\nexport const readonlyHandler = {\r\n    get: readonlyGet,\r\n    set:(target,key,value)=>{\r\n        console.error(\"set on key is failed\" )\r\n    }\r\n};\r\nexport const shallowReadonlyHandler = {\r\n    get: shallowReadonlyGet,\r\n    set:(target,key,value)=>{\r\n        console.error(\"set on key is failed\" )\r\n    }\r\n};\r\n","import {isObject} from \"@hzb/shared\";\r\nimport {reactiveHandler,shallowReactiveHandler,readonlyHandler,shallowReadonlyHandler} from './baseHandler'\r\n\r\nexport function reactive(target) {\r\n    return createReactObj(target, false, reactiveHandler);\r\n}\r\n\r\nexport function shallowReactive(target) {\r\n    return createReactObj(target, false, shallowReactiveHandler);\r\n}\r\n\r\nexport function readonly(target) {\r\n    return createReactObj(target, true, readonlyHandler);\r\n}\r\n\r\nexport function shallowReadonly(target) {\r\n    return createReactObj(target, true, shallowReadonlyHandler);\r\n}\r\n\r\n//哈希表，避免重复代理\r\nconst reactiveMap = new WeakMap();\r\nconst readonlyMap = new WeakMap();\r\n\r\nfunction createReactObj(target, isReadobly, baseHandler) {\r\n    if (!isObject(target)) {\r\n        return target\r\n    } else {\r\n        //优化，避免重复优化\r\n        const proxyMap = isReadobly ? readonlyMap : reactiveMap;\r\n        if (proxyMap.has(target)) {\r\n            return proxyMap.get(target);\r\n        } else {\r\n            const proxy = new Proxy(target, baseHandler)\r\n            proxyMap.set(target, proxy);\r\n            return proxy\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}